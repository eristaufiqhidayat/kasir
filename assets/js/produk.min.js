let url,
	produk = $("#produk").DataTable({
		responsive: !0,
		scrollX: !0,
		ajax: readUrl,
		pageLength: 25,
		columnDefs: [{ searcable: !1, orderable: !1, targets: 0 }],
		order: [[1, "asc"]],
		columns: [
			{ data: null },
			{ data: "barcode" },
			{ data: "nama" },
			{ data: "satuan" },
			{ data: "kategori" },
			{ data: "harga_perolehan" },
			{ data: "harga" },
			{ data: "stok" },
			{ data: "action" },
		],
	});
function reloadTable() {
	produk.ajax.reload();
}
function addData() {
	$.ajax({
		url: addUrl,
		type: "post",
		dataType: "json",
		data: $("#form").serialize(),
		success: (a) => {
			$(".modal").modal("hide"),
				Swal.fire("Sukses", "Sukses Menambahkan Data", "success"),
				reloadTable();
		},
		error: (a) => {
			console.log(a);
		},
	});
}
function remove(e) {
	swal({
		title: "Hapus Data ?",
		text: "yakin data ini akan di hapus",
		icon: "warning",
		buttons: ["No", "Yes"],
		dangerMode: true,
	}).then(function (isConfirm) {
		if (isConfirm) {
			$.ajax({
				url: deleteUrl,
				type: "post",
				dataType: "json",
				data: {
					id: e,
				},
				success: () => {
					Swal.fire("Sukses", "Sukses Menghapus Data", "success"),
						reloadTable();
				},
				error: () => {
					console.log(a);
				},
			});
		} else {
			swal("Cancelled", "File tidak jadi dihapus", "error");
		}
	});
}
function editData() {
	$.ajax({
		url: editUrl,
		type: "post",
		dataType: "json",
		data: $("#form").serialize(),
		success: () => {
			$(".modal").modal("hide"),
				Swal.fire("Sukses", "Sukses Mengedit Data", "success"),
				reloadTable();
		},
		error: (a) => {
			console.log(a);
		},
	});
}
function add() {
	(url = "add"),
		$(".modal-title").html("Add Data"),
		$('.modal button[type="submit"]').html("Add");
}
function edit(a) {
	$.ajax({
		url: getProdukUrl,
		type: "post",
		dataType: "json",
		data: { id: a },
		success: (a) => {
			$('[name="id"]').val(a.id),
				$('[name="barcode"]').val(a.barcode),
				$('[name="barcode"]').attr("readonly", true),
				$('[name="nama_produk"]').val(a.nama_produk),
				$('[name="nama_produk"]').attr("readonly", true),
				$('[name="satuan"]').append(
					`<option value='${a.satuan_id}'>${a.satuan}</option>`
				),
				$('[name="satuan"]').attr("readonly", true),
				$('[name="kategori"]').append(
					`<option value='${a.kategori_id}'>${a.kategori}</option>`
				),
				$('[name="kategori"]').attr("readonly", true),
				$('[name="harga_perolehan"]').val(a.harga_perolehan),
				$('[name="harga_perolehan"]').attr("readonly", true),
				$('[name="harga"]').val(a.harga),
				$('[name="stok"]').val(a.stok),
				$('[name="stok"]').attr("readonly", true),
				$(".modal").modal("show"),
				$(".modal-title").html("Edit Data"),
				$('.modal button[type="submit"]').html("Edit"),
				(url = "edit");
		},
		error: (a) => {
			console.log(a);
		},
	});
}
produk.on("order.dt search.dt", () => {
	produk
		.column(0, { search: "applied", order: "applied" })
		.nodes()
		.each((a, e) => {
			a.innerHTML = e + 1;
		});
}),
	$("#form").validate({
		errorElement: "span",
		errorPlacement: (a, e) => {
			a.addClass("invalid-feedback"), e.closest(".form-group").append(a);
		},
		submitHandler: () => {
			"edit" == url ? editData() : addData();
		},
	}),
	$("#kategori").select2({
		placeholder: "Kategori",
		ajax: {
			url: kategoriSearchUrl,
			type: "post",
			dataType: "json",
			data: (a) => ({ kategori: a.term }),
			processResults: (a) => ({ results: a }),
			cache: !0,
		},
	}),
	$("#satuan").select2({
		placeholder: "Satuan",
		ajax: {
			url: satuanSearchUrl,
			type: "post",
			dataType: "json",
			data: (a) => ({ satuan: a.term }),
			processResults: (a) => ({ results: a }),
			cache: !0,
		},
	}),
	$(".modal").on("hidden.bs.modal", () => {
		$("#form")[0].reset(), $("#form").validate().resetForm();
	});
