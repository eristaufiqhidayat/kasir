let stok_opname = $("#stok_opname").DataTable({
	responsive: !0,
	scrollX: !0,
	ajax: readUrl,
	columnDefs: [{ searcable: !1, orderable: !1, targets: 0 }],
	order: [[1, "desc"]],
	columns: [
		{ data: null },
		{ data: "tanggal" },
		{ data: "barcode" },
		{ data: "nama_produk" },
		{ data: "jumlah" },
		{ data: "jumlah_opname" },
		{ data: "harga_perolehan" },
		{ data: "keterangan" },
	],
});
function reloadTable() {
	stok_opname.ajax.reload();
}
function checkKeterangan(a) {
	"lain" == a.value
		? ($(".supplier").hide(),
		  $("#supplier").attr("disabled", "disabled"),
		  $(".lain").removeClass("d-none"))
		: ($(".lain").addClass("d-none"),
		  $("#supplier").removeAttr("disabled"),
		  $(".supplier").show());
}
function addData() {
	$.ajax({
		url: addUrl,
		type: "post",
		dataType: "json",
		data: $("#form").serialize(),
		success: () => {
			$(".modal").modal("hide"),
				Swal.fire("Sukses", "Sukses Menambahkan Data", "success"),
				reloadTable();
		},
		error: (a) => {
			console.log(a);
		},
	});
}
function checkdetil() {
	a = $("#barcode").val();
	$.ajax({
		url: getBarcodebyadUrl,
		type: "post",
		dataType: "json",
		data: { barcode: a },
		success: (a) => {
			$('[name="jumlah"]').val(a[0].stok);
			$('[name="harga_perolehan"]').val(a[0].harga_perolehan);
			console.log(a);
		},
		error: () => {
			console.log(a);
		},
	});
}
stok_opname.on("order.dt search.dt", () => {
	stok_opname
		.column(0, { search: "applied", order: "applied" })
		.nodes()
		.each((a, e) => {
			a.innerHTML = e + 1;
		});
}),
	$("#form").validate({
		errorElement: "span",
		errorPlacement: (a, e) => {
			a.addClass("invalid-feedback"), e.closest(".form-group").append(a);
		},
		submitHandler: () => {
			addData();
		},
	}),
	$("#tanggal").datetimepicker({ format: "dd-mm-yyyy h:ii:ss" }),
	$("#barcode").select2({
		placeholder: "Barcode",
		ajax: {
			url: getBarcodeUrl,
			type: "post",
			dataType: "json",
			data: (a) => ({ barcode: a.term }),
			processResults: (a) => ({ results: a }),
			cache: !0,
		},
	}),
	$("#supplier").select2({
		placeholder: "Supplier",
		ajax: {
			url: supplierSearchUrl,
			type: "post",
			dataType: "json",
			data: (a) => ({ supplier: a.term }),
			processResults: (a) => ({ results: a }),
			cache: !0,
		},
	}),
	$(".modal").on("hidden.bs.modal", () => {
		$("#form")[0].reset(), $("#form").validate().resetForm();
	}),
	$(".modal").on("show.bs.modal", () => {
		let a = moment().format("D-MM-Y H:mm:ss");
		$("#tanggal").val(a);
	});
